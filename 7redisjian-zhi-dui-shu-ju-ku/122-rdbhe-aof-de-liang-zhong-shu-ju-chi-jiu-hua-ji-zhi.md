# 122 RDB和AOF的两种数据持久化机制

持久化:redis提供了两种数据备份方式，一章是RDB，另外一种是AOF

|  | RDB | AOF |
| :--- | :--- | :--- |
| 开启关闭 | 开启:默认开启。关闭:把配置文件中所有的save都注释，就是关闭了 | 开启:在配置文件中appendonlyyes即开启了aof，为no关闭 |
| 同步机制 | 可以指定某个时间内发生多少个命令进行同步。比如"save 900 1",如果在900s内发生了1此数据更改操作，那么就会做一次同步操作 | （1）appendfsync always:每次有数据更新操作，都会同步到文件中。（2）appendfsyc everysec:每秒进行一次更新。（3）appendfsync no:使用操作系统的方式进行更新，普遍是30s更新一次 |
| 存储内容 | 存储的是redis里面的具体的值，并且使经过压缩后存储进去的 | 存储的是执行的写操作命令 |
| 优点 | （1）存储数据到文件中会进行注释，文件体积比aof小。（2）因为存储的是redis具体的值，并且会经过压缩，因此在恢复的时候速度比AOF快。（3）非常适用于备份 | （1）AOF的策略是每秒钟或者每次发生写操作的时候都会同步，因此即使服务器故障，最多只会丢失1秒的数据。（2）AOF存储的redis命令，并且使直接追加到aof文件后面，因此每次备份的时候只要添加新的数据进去就可以了。（3）如果AOF文件比较大了，那么Redis会进行重写，只保留最小的命令集合 |
| 缺点 | （1）RDB在多少时间内发生了多少写操作的时候就会触发同步机制，因为采用压缩机制，RDB在同步的时候都重新保存整个Redis中的数据，因此在一般会设置在最少5分钟才保存一次数据。在这种情况下，一旦服务器故障，会造成5分钟的数据丢失。（2）在数据保存进RDB的时候，Redis会fork出一个子进程来同步，在数据量比较大的时候，可能会非常耗时。 | （1）AOF文件因为没有压缩，因此体积比RDB大。（2）AOF是在每秒或者每次写操作都进行备份，因此如果并发了比较大，效率可能有点慢。（3）AOF文件因为存储的是命令，因此在灾难恢复的时候Redis会重新运行AOF中的命令，速度不及RDB |
| 存储文件的路径 | 根据dir以及rdbfilename来指定路径和具体的文件名 | 根据dir以及appendfilename来指定具体的路径和文件名 |

注意修改完配置，需重启服务:sudo service redis-server restart

配置文件:redis.windows-service.conf

更多细节:[http://redisdoc.com/topic/persistence.html\#redis](http://redisdoc.com/topic/persistence.html#redis)

